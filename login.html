<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒêƒÉng nh·∫≠p h·ªá th·ªëng</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* CSS inline ƒë·ªÉ ƒë·∫£m b·∫£o hi·ªÉn th·ªã ƒë√∫ng */
        .hidden {
            display: none !important;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .toast-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 8px;
            padding: 12px 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 9999;
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateX(120%);
            transition: transform 0.3s ease;
        }
        
        .toast-notification.show {
            transform: translateX(0);
        }
        
        .toast-success {
            border-left: 4px solid #10b981;
        }
        
        .toast-error {
            border-left: 4px solid #ef4444;
        }
        
        .toast-info {
            border-left: 4px solid #3b82f6;
        }
        
        #loadingOverlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9998;
        }
        
        #loadingOverlay.show {
            display: flex;
        }
        
        .loading-spinner {
            text-align: center;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4a6ee0;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: #333;
            font-weight: 500;
        }
        
        /* Error message styling */
        .error-message {
            background: #fee;
            border: 1px solid #fcc;
            border-radius: 6px;
            padding: 10px 15px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #c00;
            font-size: 14px;
        }
        
        .error-message i {
            font-size: 16px;
        }
        
        .error-message button {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            margin-left: auto;
            padding: 0;
        }
        
        .error-message button:hover {
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="login-card">
            <div class="login-header">
                <button class="back-btn" onclick="goBack()">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h1 id="loginTitle">ƒêƒÉng nh·∫≠p</h1>
            </div>
            
            <!-- Selector lo·∫°i ƒëƒÉng nh·∫≠p -->
            <div class="login-type-selector">
                <button class="type-btn active" onclick="switchLoginType('admin')">
                    <i class="fas fa-user-shield"></i> Admin
                </button>
                <button class="type-btn" onclick="switchLoginType('hkd')">
                    <i class="fas fa-user-tie"></i> HKD
                </button>
            </div>
            
            <!-- Form ƒëƒÉng nh·∫≠p -->
            <form id="loginForm" class="login-form">
                <div class="form-group" id="phoneGroup">
                    <label for="phone">S·ªë ƒëi·ªán tho·∫°i:</label>
                    <div class="input-with-icon">
                        <i class="fas fa-phone"></i>
                        <input type="tel" id="phone" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="password">M·∫≠t kh·∫©u:</label>
                    <div class="input-with-icon">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="password" placeholder="Nh·∫≠p m·∫≠t kh·∫©u" required>
                        <button type="button" class="toggle-password" onclick="togglePassword()">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-sign-in-alt"></i> ƒêƒÉng nh·∫≠p
                    </button>
                </div>
            </form>
            
            <!-- Link ƒëƒÉng k√Ω -->
            <div class="register-link text-center mt-4" id="registerLink">
                <p>Ch∆∞a c√≥ t√†i kho·∫£n HKD? 
                    <a href="#" class="register-link-btn" id="registerLinkBtn">
                        <i class="fas fa-user-plus"></i> ƒêƒÉng k√Ω ngay
                    </a>
                </p>
            </div>
            
            <!-- Th√¥ng tin ƒëƒÉng nh·∫≠p m·∫∑c ƒë·ªãnh -->
            <div class="login-info">
                <p><strong>Th√¥ng tin ƒëƒÉng nh·∫≠p m·∫∑c ƒë·ªãnh:</strong></p>
                <div id="defaultAdminInfo">
                    <p>Admin: <code>admin / 123123</code></p>
                </div>
                <div id="defaultHKDInfo" style="display: none;">
                    <p>HKD: S·ª≠ d·ª•ng SƒêT v√† m·∫≠t kh·∫©u do Admin c·∫•p</p>
                </div>
            </div>
            
            <!-- Form ƒëƒÉng k√Ω (·∫©n ban ƒë·∫ßu) -->
            <div class="register-section hidden" id="registerSection">
                <hr>
                <h5 class="text-center mb-3">ƒêƒÉng k√Ω HKD m·ªõi</h5>
                
                <form id="registerForm" class="register-form">
                    <div class="form-group">
                        <label for="registerName">T√™n HKD *</label>
                        <div class="input-with-icon">
                            <i class="fas fa-store"></i>
                            <input type="text" id="registerName" placeholder="Nh·∫≠p t√™n c·ª≠a h√†ng" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="registerPhone">S·ªë ƒëi·ªán tho·∫°i *</label>
                        <div class="input-with-icon">
                            <i class="fas fa-phone"></i>
                            <input type="tel" id="registerPhone" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="registerAddress">ƒê·ªãa ch·ªâ</label>
                        <div class="input-with-icon">
                            <i class="fas fa-map-marker-alt"></i>
                            <input type="text" id="registerAddress" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ (tu·ª≥ ch·ªçn)">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="registerPassword">M·∫≠t kh·∫©u *</label>
                        <div class="input-with-icon">
                            <i class="fas fa-lock"></i>
                            <input type="password" id="registerPassword" placeholder="Nh·∫≠p m·∫≠t kh·∫©u (6+ k√Ω t·ª±)" required>
                            <button type="button" class="toggle-password" onclick="toggleRegisterPassword()">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="registerConfirmPassword">X√°c nh·∫≠n m·∫≠t kh·∫©u *</label>
                        <div class="input-with-icon">
                            <i class="fas fa-lock"></i>
                            <input type="password" id="registerConfirmPassword" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u" required>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn-success">
                            <i class="fas fa-user-plus"></i> ƒêƒÉng k√Ω ngay
                        </button>
                        <button type="button" class="btn-secondary" onclick="showLoginForm()">
                            <i class="fas fa-sign-in-alt"></i> Quay l·∫°i ƒëƒÉng nh·∫≠p
                        </button>
                    </div>
                </form>
                
                <div class="register-info mt-3">
                    <p class="small text-muted">
                        <i class="fas fa-info-circle"></i> 
                        Sau khi ƒëƒÉng k√Ω, b·∫°n c√≥ th·ªÉ ƒëƒÉng nh·∫≠p ngay b·∫±ng SƒêT v√† m·∫≠t kh·∫©u ƒë√£ ƒëƒÉng k√Ω.
                    </p>
                </div>
            </div>
            
            <!-- Footer -->
            <div class="login-footer">
                <p>Phi√™n b·∫£n 1.0 - H·ªá th·ªëng b√°n h√†ng Firebase</p>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/firebase-config.js"></script>
    <script src="js/indexedDB.js"></script>
    <script src="js/sync-manager.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/init.js"></script>

    <script>
        // Bi·∫øn c·ª•c b·ªô trong scope n√†y
        let loginType = 'admin';
        let loginPageCurrentUser = null; // ƒê·ªïi t√™n ƒë·ªÉ tr√°nh tr√πng v·ªõi auth.js
        
        // Kh·ªüi t·∫°o trang
        function initLoginPage() {
            // X√°c ƒë·ªãnh lo·∫°i ƒëƒÉng nh·∫≠p t·ª´ URL
            const urlParams = new URLSearchParams(window.location.search);
            loginType = urlParams.get('type') || 'admin';
            
            switchLoginType(loginType);
            
            // X·ª≠ l√Ω form ƒëƒÉng nh·∫≠p
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    handleLogin();
                });
            }
            
            // X·ª≠ l√Ω form ƒëƒÉng k√Ω
            const registerForm = document.getElementById('registerForm');
            if (registerForm) {
                registerForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    handleRegister(e);
                });
            }
            
            // X·ª≠ l√Ω n√∫t ƒëƒÉng k√Ω
            const registerLinkBtn = document.getElementById('registerLinkBtn');
            if (registerLinkBtn) {
                registerLinkBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    showRegisterForm();
                });
            }
            
            // X·ª≠ l√Ω n√∫t quay l·∫°i ƒëƒÉng nh·∫≠p trong form ƒëƒÉng k√Ω
            const backToLoginBtn = document.querySelector('#registerForm .btn-secondary');
            if (backToLoginBtn) {
                backToLoginBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    showLoginForm();
                });
            }
        }
        
        // Chuy·ªÉn ƒë·ªïi lo·∫°i ƒëƒÉng nh·∫≠p
        function switchLoginType(type) {
            loginType = type;
            
            // C·∫≠p nh·∫≠t UI buttons
            const adminBtn = document.querySelector('.type-btn:nth-child(1)');
            const hkdBtn = document.querySelector('.type-btn:nth-child(2)');
            
            if (adminBtn && hkdBtn) {
                adminBtn.classList.toggle('active', type === 'admin');
                hkdBtn.classList.toggle('active', type === 'hkd');
            }
            
            // C·∫≠p nh·∫≠t ti√™u ƒë·ªÅ
            const title = document.getElementById('loginTitle');
            if (title) {
                title.textContent = type === 'admin' ? 'ƒêƒÉng nh·∫≠p Admin' : 'ƒêƒÉng nh·∫≠p HKD';
            }
            
            // C·∫≠p nh·∫≠t th√¥ng tin m·∫∑c ƒë·ªãnh
            const defaultAdmin = document.getElementById('defaultAdminInfo');
            const defaultHKD = document.getElementById('defaultHKDInfo');
            
            if (defaultAdmin) defaultAdmin.style.display = type === 'admin' ? 'block' : 'none';
            if (defaultHKD) defaultHKD.style.display = type === 'hkd' ? 'block' : 'none';
        }
        
        // Quay l·∫°i trang ch√≠nh
        function goBack() {
            window.location.href = 'index.html';
        }
        
        // Hi·ªÉn th·ªã/·∫©n m·∫≠t kh·∫©u
        function togglePassword() {
            const passwordInput = document.getElementById('password');
            const toggleBtn = document.querySelector('.toggle-password i');
            
            if (!passwordInput || !toggleBtn) return;
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleBtn.className = 'fas fa-eye-slash';
            } else {
                passwordInput.type = 'password';
                toggleBtn.className = 'fas fa-eye';
            }
        }
        
        // Hi·ªÉn th·ªã/·∫©n m·∫≠t kh·∫©u ƒëƒÉng k√Ω
        function toggleRegisterPassword() {
            const passwordInput = document.getElementById('registerPassword');
            const toggleBtn = document.querySelector('#registerForm .toggle-password i');
            
            if (!passwordInput || !toggleBtn) return;
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleBtn.className = 'fas fa-eye-slash';
            } else {
                passwordInput.type = 'password';
                toggleBtn.className = 'fas fa-eye';
            }
        }
        
        // X·ª≠ l√Ω ƒëƒÉng nh·∫≠p
        async function handleLogin() {
            const phone = document.getElementById('phone')?.value;
            const password = document.getElementById('password')?.value;
            
            if (!phone || !password) {
                showError('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin');
                return;
            }
            
            try {
                if (loginType === 'admin') {
                    // ƒêƒÉng nh·∫≠p admin
                    const success = await authenticateAdmin(phone, password);
                    if (success) {
                        localStorage.setItem('lastLogin', 'admin');
                        window.location.href = 'admin.html';
                    }
                } else {
                    // ƒêƒÉng nh·∫≠p HKD
                    const success = await authenticateHKD(phone, password);
                    if (success) {
                        localStorage.setItem('lastLogin', 'hkd');
                        window.location.href = 'hkd.html';
                    }
                }
            } catch (error) {
                showError(error.message);
            }
        }
        
        // Hi·ªÉn th·ªã l·ªói
        function showError(message) {
            // X√≥a l·ªói c≈©
            const oldError = document.querySelector('.error-message');
            if (oldError) oldError.remove();
            
            // T·∫°o th√¥ng b√°o l·ªói m·ªõi
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.innerHTML = `
                <i class="fas fa-exclamation-circle"></i>
                <span>${message}</span>
                <button onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            // Th√™m v√†o form
            const form = document.getElementById('loginForm');
            if (form) form.prepend(errorDiv);
        }
        
        // Chuy·ªÉn sang form ƒëƒÉng k√Ω
        function showRegisterForm() {
            console.log('üìù Hi·ªÉn th·ªã form ƒëƒÉng k√Ω');
            
            // ·∫®n form ƒëƒÉng nh·∫≠p v√† c√°c ph·∫ßn li√™n quan
            const loginForm = document.getElementById('loginForm');
            const registerLink = document.getElementById('registerLink');
            const defaultAdminInfo = document.getElementById('defaultAdminInfo');
            const defaultHKDInfo = document.getElementById('defaultHKDInfo');
            
            if (loginForm) loginForm.classList.add('hidden');
            if (registerLink) registerLink.style.display = 'none';
            if (defaultAdminInfo) defaultAdminInfo.style.display = 'none';
            if (defaultHKDInfo) defaultHKDInfo.style.display = 'none';
            
            // Hi·ªÉn th·ªã form ƒëƒÉng k√Ω
            const registerSection = document.getElementById('registerSection');
            if (registerSection) {
                registerSection.style.display = 'block';
                setTimeout(() => registerSection.classList.remove('hidden'), 10);
            }
            
            // Chuy·ªÉn sang lo·∫°i HKD
            switchLoginType('hkd');
        }
        
        // Chuy·ªÉn v·ªÅ form ƒëƒÉng nh·∫≠p
        function showLoginForm() {
            console.log('üîê Hi·ªÉn th·ªã form ƒëƒÉng nh·∫≠p');
            
            // ·∫®n form ƒëƒÉng k√Ω
            const registerSection = document.getElementById('registerSection');
            if (registerSection) {
                registerSection.classList.add('hidden');
                setTimeout(() => {
                    registerSection.style.display = 'none';
                }, 300);
            }
            
            // Hi·ªÉn th·ªã form ƒëƒÉng nh·∫≠p v√† c√°c ph·∫ßn li√™n quan
            const loginForm = document.getElementById('loginForm');
            const registerLink = document.getElementById('registerLink');
            const defaultAdminInfo = document.getElementById('defaultAdminInfo');
            
            if (loginForm) loginForm.classList.remove('hidden');
            if (registerLink) registerLink.style.display = 'block';
            if (defaultAdminInfo) defaultAdminInfo.style.display = 'block';
            
            // Reset form ƒëƒÉng k√Ω
            const registerForm = document.getElementById('registerForm');
            if (registerForm) registerForm.reset();
            
            // Chuy·ªÉn v·ªÅ lo·∫°i ƒëƒÉng nh·∫≠p m·∫∑c ƒë·ªãnh
            switchLoginType('admin');
        }
        
        // X·ª≠ l√Ω ƒëƒÉng k√Ω HKD
        async function handleRegister(event) {
            event.preventDefault();
            
            // L·∫•y d·ªØ li·ªáu t·ª´ form
            const name = document.getElementById('registerName')?.value.trim();
            const phone = document.getElementById('registerPhone')?.value.trim();
            const address = document.getElementById('registerAddress')?.value.trim();
            const password = document.getElementById('registerPassword')?.value;
            const confirmPassword = document.getElementById('registerConfirmPassword')?.value;
            
            // Validation c∆° b·∫£n
            if (!name || !phone || !password) {
                showToast('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin b·∫Øt bu·ªôc', 'error');
                return;
            }
            
            if (password.length < 6) {
                showToast('M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showToast('M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp', 'error');
                return;
            }
            
            // S·ª≠ d·ª•ng h√†m validatePhone t·ª´ utils.js
            if (typeof Utils !== 'undefined' && Utils.validatePhone) {
                if (!Utils.validatePhone(phone)) {
                    showToast('S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá', 'error');
                    return;
                }
            }
            
            try {
                showLoading('ƒêang ƒëƒÉng k√Ω t√†i kho·∫£n...');
                
                // Kh·ªüi t·∫°o Firebase n·∫øu c·∫ßn
                if (typeof initFirebase === 'function') {
                    await initFirebase();
                }
                
                // Ki·ªÉm tra s·ªë ƒëi·ªán tho·∫°i ƒë√£ t·ªìn t·∫°i ch∆∞a
                const isDuplicate = await checkDuplicatePhone(phone);
                if (isDuplicate) {
                    throw new Error('S·ªë ƒëi·ªán tho·∫°i ƒë√£ ƒë∆∞·ª£c ƒëƒÉng k√Ω');
                }
                
                // T·∫°o ID cho HKD - s·ª≠ d·ª•ng h√†m t·ª´ utils.js
                const hkdId = (typeof Utils !== 'undefined' && Utils.generateId) 
                    ? Utils.generateId() 
                    : 'hkd_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                
                // D·ªØ li·ªáu HKD
                const hkdData = {
                    id: hkdId,
                    name: name,
                    phone: phone,
                    address: address,
                    password: password,
                    role: 'hkd',
                    createdAt: new Date().toISOString(),
                    lastUpdated: new Date().toISOString(),
                    _synced: true,
                    _autoRegistered: true
                };
                
                // L∆∞u l√™n Firebase n·∫øu c√≥
                if (typeof firebase !== 'undefined') {
                    const firebaseData = {
                        info: {
                            name: name,
                            phone: phone,
                            address: address,
                            password: password,
                            role: 'hkd',
                            createdAt: hkdData.createdAt,
                            lastUpdated: hkdData.lastUpdated,
                            _syncedAt: new Date().toISOString(),
                            _autoRegistered: true
                        },
                        categories: {},
                        invoices: {}
                    };
                    
                    const hkdRef = firebase.database().ref(`hkds/${hkdId}`);
                    await hkdRef.set(firebaseData);
                    
                    console.log('‚úÖ ƒê√£ t·∫°o HKD tr√™n Firebase:', hkdId);
                }
                
                // L∆∞u v√†o IndexedDB n·∫øu c√≥
                if (typeof updateInStore === 'function') {
                    try {
                        await updateInStore(STORES.HKDS, hkdData);
                        console.log('‚úÖ ƒê√£ l∆∞u HKD v√†o IndexedDB');
                    } catch (dbError) {
                        console.warn('‚ö†Ô∏è Kh√¥ng th·ªÉ l∆∞u v√†o IndexedDB:', dbError);
                    }
                }
                
                // L∆∞u th√¥ng tin user ƒë·ªÉ t·ª± ƒë·ªông ƒëƒÉng nh·∫≠p
                loginPageCurrentUser = {
                    id: hkdId,
                    phone: phone,
                    name: name,
                    address: address,
                    role: 'hkd',
                    loginTime: new Date().toISOString()
                };
                
                // S·ª≠ d·ª•ng h√†m setCurrentUser t·ª´ auth.js n·∫øu c√≥, n·∫øu kh√¥ng th√¨ d√πng localStorage
                if (typeof setCurrentUser === 'function') {
                    setCurrentUser(loginPageCurrentUser);
                } else {
                    localStorage.setItem('currentUser', JSON.stringify(loginPageCurrentUser));
                }
                
                showToast('ƒêƒÉng k√Ω th√†nh c√¥ng! ƒêang chuy·ªÉn h∆∞·ªõng...', 'success');
                
                setTimeout(() => {
                    window.location.href = 'hkd.html';
                }, 1500);
                
            } catch (error) {
                console.error('‚ùå L·ªói ƒëƒÉng k√Ω:', error);
                showToast(`L·ªói ƒëƒÉng k√Ω: ${error.message}`, 'error');
            } finally {
                hideLoading();
            }
        }
        
        // Ki·ªÉm tra s·ªë ƒëi·ªán tho·∫°i tr√πng
        async function checkDuplicatePhone(phone) {
            try {
                if (typeof firebase === 'undefined') return false;
                
                const hkdsRef = firebase.database().ref('hkds');
                const snapshot = await hkdsRef.once('value');
                const hkdsData = snapshot.val();
                
                if (!hkdsData) return false;
                
                for (const [hkdId, hkdData] of Object.entries(hkdsData)) {
                    if (hkdData.info && hkdData.info.phone === phone) {
                        return true;
                    }
                }
                
                return false;
                
            } catch (error) {
                console.error('‚ùå L·ªói ki·ªÉm tra tr√πng s·ªë ƒëi·ªán tho·∫°i:', error);
                throw error;
            }
        }
        
        // Helper: Hi·ªÉn th·ªã toast th√¥ng b√°o
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast-notification toast-${type}`;
            toast.innerHTML = `
                <div class="toast-content">
                    <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 10);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
        
        // Helper: Hi·ªÉn th·ªã loading
        function showLoading(message) {
            let loading = document.getElementById('loadingOverlay');
            if (!loading) {
                loading = document.createElement('div');
                loading.id = 'loadingOverlay';
                loading.innerHTML = `
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                        <div class="loading-text">${message}</div>
                    </div>
                `;
                document.body.appendChild(loading);
            } else {
                const textEl = loading.querySelector('.loading-text');
                if (textEl) textEl.textContent = message;
            }
            loading.classList.add('show');
        }
        
        // Helper: ·∫®n loading
        function hideLoading() {
            const loading = document.getElementById('loadingOverlay');
            if (loading) {
                loading.classList.remove('show');
                setTimeout(() => {
                    if (loading.parentNode) loading.parentNode.removeChild(loading);
                }, 300);
            }
        }
        
        // Kh·ªüi t·∫°o khi trang load
        document.addEventListener('DOMContentLoaded', initLoginPage);
        
        // Export c√°c h√†m ra window ƒë·ªÉ s·ª≠ d·ª•ng t·ª´ HTML attributes
        window.goBack = goBack;
        window.switchLoginType = switchLoginType;
        window.togglePassword = togglePassword;
        window.showRegisterForm = showRegisterForm;
        window.showLoginForm = showLoginForm;
        window.toggleRegisterPassword = toggleRegisterPassword;
    </script>
</body>
</html>